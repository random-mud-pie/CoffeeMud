<?xml version="1.0"?>
<!-- ----------------------------------------------------------------------------
Copyright 2019-2019 Bo Zimmerman

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
--------------------------------------------------------------------------------

See guides/RandomAreas.html for information about documents of this type.
<!-- 
TODO: add QUEST_TEMPLATE_ID to the official parms list -->
-->


<!-- 
template: normal_capture1
vars: 
    source_area_name(area name)
    source_name(mob name)
    source_room(mob room)
    target_name(mobs name)
    num_targets(num mobs to capture)
	aggression(YES,NO)
	xp_amount_awarded
	gold_amount_awarded
	quest_point_awarded(YES,NO)
-->

<string id="quest_template" merge=true select="any-1" define="quest_template">
	<string condition="$template=''">normal_capture1</string>
</string>

<QUEST id="all" merge=true QUEST_TEMPLATE_ID="$quest_template" condition="$quest_template='normal_capture1'">
	<QUEST_ID define="quest_id">${_:source_area_name}_${_:source_name}_${_:quest_template}_R$[100000000?999999999]</QUEST_ID>
	<QUEST_CRITERIA>-LEVELS +&gt;$[$target_level - $level_range] +&lt;$[$target_level + $level_range]</QUEST_CRITERIA>
	<ANNOUNCER_AREA>"$source_area_name"</ANNOUNCER_AREA>
	<ANNOUNCER_ROOM>"$source_room_id"</ANNOUNCER_ROOM>
	<ANNOUNCER_NAME>"$source_name"</ANNOUNCER_NAME>
	<CAPTURABLES_MASK>-HOME "+$target_area_name" -NAMES "+$target_name"</CAPTURABLES_MASK>
	<NUM_CAPTURABLES>$num_targets</NUM_CAPTURABLES>
	<CAPTURABLES_ATTACK>$will_attack_code</CAPTURABLES_ATTACK>
	<CAPTURABLES_FOLLOW>$will_react_peacefully</CAPTURABLES_FOLLOW>
	<QUEST_POINT>$quest_point_awarded</QUEST_POINT>
	<GOLD>$gold_amount_awarded</GOLD>
	<EXP>$xp_amount_awarded</EXP>
	<MULTIPLE>$quest_repeatable</MULTIPLE>
	<NEXT_QUEST></NEXT_QUEST>
	<FACTION></FACTION><!-- TODO -->
	<NUMFACTION></NUMFACTION><!-- TODO -->
	<QUEST_NAME>${C:source_name} in ${C:source_area_name} needs $num_targets ${p:target_name} captured</QUEST_NAME><!-- TODO -->
	<QUEST_NOTIFYSTRING>I have someone I need captured!  Are you game?</QUEST_NOTIFYSTRING>
	<QUEST_INSTRUCTIONSSTRING>I need you to capture $num_targets ${p:target_name}.  They are somewhere around somewhere.  Just beat them senseless, and they will yield to you.</QUEST_INSTRUCTIONSSTRING>
	<QUEST_WINSPEECH_TEXT>Aha, we got them! Congratulations!</QUEST_WINSPEECH_TEXT>
	<QUEST_LOSESPEECH_TEXT>Looks like I'll have wait for the law to get after them.</QUEST_LOSESPEECH_TEXT>
	<CAPTURABLES_RESPONSE>So, you've come for me.  Come and get me.</CAPTURABLES_RESPONSE>
	<CAPTURABLES_SURRENDER>I surrender</CAPTURABLES_SURRENDER>
	
	<STRING id="aggression" DEFINE="aggression" SELECT="Pick-1" merge=true condition="$quest_template='normal_capture1'">
		<STRING PICKWEIGHT=50>NO</STRING>
		<STRING PICKWEIGHT="$target_level">YES</STRING>
	</STRING>
	
	<STRING id="will_attack_code" DEFINE="will_attack_code" SELECT="Any-1" merge=true condition="$quest_template='normal_capture1'">
		<STRING CONDITION="$aggression='NO'">NO-USE-DEFAULT_BEHAVIOR</STRING>
		<STRING CONDITION="$aggression='YES'">YES-ATTACK-ON-SIGHT</STRING>
	</STRING>
	
	<STRING id="will_react_peacefully" DEFINE="will_react_peacefully" SELECT="Any-1" merge=true condition="$quest_template='normal_capture1'">
		<STRING CONDITION="$aggression='NO'">PEACEFUL</STRING>
		<STRING CONDITION="$aggression='YES'">VIOLENT</STRING>
	</STRING>
	
	<STRING ID="quest_point_awarded" DEFINE="quest_point_awarded" SELECT="Pick-1" merge=true condition="$quest_template='normal_capture1'">
		<STRING PICKWEIGHT=2>NO</STRING>
		<STRING PICKWEIGHT=1>YES</STRING>
	</STRING>
	
	<STRING ID="gold_amount_awarded" DEFINE="gold_amount_awarded" select="any-1" merge=true condition="$quest_template='normal_capture1'">
		<STRING>$[$target_level*2]</STRING>
	</STRING>
	
	<STRING ID="xp_amount_awarded" DEFINE="xp_amount_awarded" select="any-1" merge=true condition="$quest_template='normal_capture1'">
		<STRING>$[100 + $target_level*3]</STRING>
	</STRING>
	
	<STRING ID="quest_repeatable" DEFINE="quest_repeatable" SELECT="Pick-1"  merge=true condition="$quest_template='normal_capture1'">
		<STRING PICKWEIGHT=99>NO</STRING>
		<STRING PICKWEIGHT=1>YES</STRING>
	</STRING>

	<OBJECT id="source_area" SELECT="Pick-1" DEFINE="source_area" merge=true condition="$quest_template='normal_capture1'">
		<OBJECT pickweight=99999 condition="'${SELECT: name FROM area}' != ''">SELECT: . FROM area</OBJECT>
		<OBJECT pickweight=1 condition="'${SELECT: name FROM area}' = ''">
			SELECT: ANY\. FROM areas WHERE (SELECT: count\. from area\npcs WHERE name\count =1 and intelligence>8 and "Aggressive" notin affbehav) > 0
				AND (SELECT:count\. from area\npcs WHERE name\count >$num_targets) > 0
		</OBJECT>
	</OBJECT>
	
	<OBJECT id="source_room" SELECT="Pick-1" DEFINE="source_room" merge=true condition="$quest_template='normal_capture1'">
		<OBJECT PICKWEIGHT=99999 CONDITION="'${SELECT: roomid FROM room}' != ''">SELECT: . FROM room</OBJECT>
		<OBJECT PICKWEIGHT=1 CONDITION="'${SELECT: roomid FROM room}' = ''">SELECT: . FROM $source\room</OBJECT>
	</OBJECT>
	
	<OBJECT id="source" SELECT="Pick-1" DEFINE="source" merge=true condition="$quest_template='normal_capture1'">
		<OBJECT PICKWEIGHT=99999 CONDITION="'${SELECT: name FROM mob}' != ''">SELECT: . FROM mob</OBJECT>
		<OBJECT PICKWEIGHT=1 CONDITION="'${SELECT: name FROM mob}' = ''">SELECT: ANY\. FROM $source_area\npcs WHERE name\count=1 and intelligence>8 and "Aggressive" notin affbehav</OBJECT>
	</OBJECT>
	
	<OBJECT id="target" define="target" select="any-1" merge=true condition="$quest_template='normal_capture1'">
		<OBJECT>SELECT: ANY\. FROM $source_area\mobs WHERE name\count>$num_targets</OBJECT>
	</OBJECT>

	<STRING id="target_level" define="target_level" select="any-1" merge=true condition="$quest_template='normal_capture1'">
		<STRING>${SELECT:mean\level from $target}</STRING>
	</STRING>
	
	<STRING id="num_targets" select="any-1" define="num_targets" merge=true condition="$quest_template='normal_capture1'">
		<STRING>$[3?10]</STRING>
	</STRING>

	<STRING id="level_range" select="any-1" define="level_range" merge=true condition="$quest_template='normal_capture1'">
		<STRING>$[3?6]</STRING>
	</STRING>

	<STRING id="source_area_name" select="any-1" define="source_area_name" merge=true condition="$quest_template='normal_capture1'">
		<STRING>${SELECT:name from $source_area}</STRING>
	</STRING>

	<STRING id="source_room_id" select="any-1" define="source_room_id" merge=true condition="$quest_template='normal_capture1'">
		<STRING>${SELECT:roomid from $source_room}</STRING>
	</STRING>

	<STRING id="source_name" select="any-1" define="source_name" merge=true condition="$quest_template='normal_capture1'">
		<STRING>${SELECT:name from $source}</STRING>
	</STRING>

	<STRING id="target_name" select="any-1" define="target_name" merge=true condition="$quest_template='normal_capture1'">
		<STRING>${SELECT:name from $target}</STRING>
	</STRING>
	
	<STRING id="target_area_name" select="any-1" define="target_area_name" merge=true condition="$quest_template='normal_capture1'">
		<STRING>$source_area_name</STRING>
	</STRING>	
</QUEST>


